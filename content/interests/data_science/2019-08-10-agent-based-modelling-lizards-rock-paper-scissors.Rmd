---
title: 'Agent-based modelling: lizards & rock, paper, scissors.'
author: Mitchel Fruin
date: '2019-08-10'
slug: agent-based-modelling-lizards-rock-paper-scissors
categories: []
tags:
  - ABM
  - Complexity
  - Evolution
output:
  blogdown::html_page:
    toc: true
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(igraph)
library(reshape2)
library(ggplot2)
```

## Rock Paper Scissors
In this second example we are going to use the same game, but this time several individuals will play against each other. To make it more interesting individuals are organised on a lattice network. Thus, they can only play with their direct neighbors. If they lose, they have to take over the strategy of the winner and vice versa. This can also be seen as a very simple example of an evolutionary process.

```{r}
# size of the lattice
sidelength<-10 
# creating an empty data.frame to store data
stat<-data.frame()
# creating a lattice network using the igraph package
l<-graph.lattice(length=sidelength,dim=2)
# now every individual chooses a strategy at random
V(l)$weapon<-sample(c(1:3), size=length(V(l)), replace=T)
# for a nicer visualisation lets colour the different options
V(l)[weapon==1]$color<-'blue' # Paper
V(l)[weapon==2]$color<-'yellow' # Scissors
V(l)[weapon==3]$color<-'green' # Rock
# and this is what it looks like:
plot(l, layout=as.matrix(expand.grid(1:sidelength, 1:sidelength)), vertex.label=NA)
for(t in 1:1000){
	# pick a random agent ...
	from <- as.numeric(sample(V(l), 1)) # or sample(sidelength^2,1)
	# who are its neighbours?
	nei<-neighbors(l, v=from, mode='all')
	
	# if there is only one weapon type left
	if(length(unique(V(l)$weapon))==1) {
		# we can either stop the simulation
		stop(paste(c('Paper','Scissors','Rock')[unique(V(l)$weapon)], 'has won the game after',t,'rounds!'))
		# or we let the selected individual choose a different strategy to let the dynamics go on
		# V(l)$weapon[from]<-sample((1:3)[1:3!=as.numeric(V(l)$weapon[from])], 1)
	} else {
		# ... and one of its neighbours
		to <- sample(nei, 1) 
		fromto<-c(from,to)
		w<-as.numeric(V(l)$weapon[fromto])
		# if both choices are equal, nothing happens:
		if(w[1]==w[2]) {} else{ 
			# in the case that one chooses Rock and the other Paper, Paper wins:
			if(max(w) == 3 && min(w) ==1) { 
				V(l)$weapon[fromto[w==3]] <- "1" 
			} 
			else{
				# for the two other cases, the better weapon wins:
				V(l)$weapon[fromto[w==min(w)]] <- V(l)$weapon[fromto[w==max(w)]]
			}
		} 
		
	}
	# let's record the individual abundance of each strategy
	stat<-rbind(stat, c(sum(V(l)$'weapon'=="1"), sum(V(l)$'weapon'=="2"), sum(V(l)$'weapon'=="3")))
	# plot(l, layout=as.matrix(expand.grid(1:sidelength, 1:sidelength)), vertex.label=NA)
}
names(stat)<-c("Paper","Scissors","Rock")
s<-melt(stat)
s$time<-1:nrow(stat)
ggplot(data=s, mapping=aes(x=time, y=value, col=variable)) + geom_line() + theme_bw() 
```