---
title: "Probability in the real world*"
date: "2019-08-15"
output:
  blogdown::html_page:
    toc: true
    toc_depth: 1
    number_sections: true
---

```{r setup, include=FALSE}
# Rmarkdown
knitr::opts_chunk$set(echo = TRUE, fig.align = "center")

# Packages
library(tidyverse)
library(reshape2)
library(treemapify)
library(waffle)

# Data
treemap_df <- tibble(group_name = c("True Pos.",
                                    "False Pos.",
                                    "True Neg.",
                                    "False Neg."),
                     frequency = c(47.5, 47.5, 902.5, 2.5),
                     test_result = c("Positive", 
                                     "Positive",
                                     "Negative", 
                                     "Negative"),
                     disease_status = c("ILL",
                                        "HEALTHY",
                                        "HEALTHY",
                                        "ILL"),
                     decision = c("Correct", 
                                  "Incorrect",
                                  "Correct",
                                  "Incorrect"))

pictogram_df <- tibble(group_name = c("True Pos.",
                                             "False Pos.",
                                             "True Neg.",
                                             "False Neg."),
                              frequency = c(9, 9, 81, 1),
                              test_result = c("Positive", 
                                              "Positive",
                                              "Negative", 
                                              "Negative"),
                              disease_status = c("Disease",
                                                 "Healthy",
                                                 "Healthy",
                                                 "Disease"),
                              decision = c("Correct", 
                                           "Incorrect",
                                           "Correct",
                                           "Incorrect"))
```

# Probability 101

## Probability vs. Statistics

Probability: Use known state of the world to predict the data we should observe.

* I have a fair coin (known state of the world) and can expect 50 heads and 50 tails, on average, from 100 flips (predicted data). 

Statistics: Use data we have observed to infer the most likely state of the world. 

* I flipped a coin 100 times and got 52 heads and 48 tails (observed data), I'm pretty sure that I have a fair coin (inferred state of the world). 

## Types of probability

Classic, based on symmetry. 

Frequentist, based on experience. 

Subjective, based on best guess. 

## Types of events

**Independent probabilities.** Should multiply. 

**Conditional probabilities.** Should use Bayes law. Visualise Bayesian updating with a contingency table/ infographic. 

## Puzzles

Sometimes probability is unintuitive. Birthday puzzle. 

# Legal problems

## Ignoring dependence

Sally Clark had two children dies from SIDS. Dr. Meadow, pediatrician, said there's 1 in 8543 chance of having a child die from SIDS giving a 1 in 73mil chance of having two children die from it. Potential genetic, environmental dependence ignored and she was sentenced for 3 years.

## The prosecutor's fallacy

**Prosecutor's fallacy:** False belief that conditional probabilities are invertible.

$$Pr(A|B) \neq Pr(B|A)$$

Forensics may compute that probability of blood at scene matching the defendent's by chance is 1%. That doesn't mean there's a 1% chance the defendent is innocent. We have been told the probability of a match given innocence, we want the probability of innocence given a match, but they don't equate:

$$Pr(\text{match}|\text{innocent}) \neq Pr(\text{innocent}|\text{match})$$

# Health problems

## Base rate neglect

Disease with 10% prevalence. Test is 90% accurate.

Let's unpack the two parts of the scenario using an example population of 100 people.

Part 1: "The disease has a prevalence of 10%":

* 10% of the 100 people have the disease $\rightarrow$ 10 people
* 90% of the 100 people don't $\rightarrow$ 90 people

Part 2: "The test is 90% accurate":

* For the 10 people with the disease
    + 90% of them will be correctly identified as positive $\rightarrow$ 9 people
        - True positives
    + 10% of them will be incorrectly identified as negative $\rightarrow$ 1 person
        - False negatives
* For the 90 people without the disease
    + 90% of them will be correctly identified as negative $\rightarrow$ 81 people
        - True negatives
    + 10% of them will be incorrectly identified as positive $\rightarrow$ 9 people
        - False positives

```{r base rate neglect, fig.height=16, fig.width=20}
# Treemap
ggplot(treemap_df, aes(area = frequency, 
                       label = group_name,
                       fill = test_result,
                       subgroup = disease_status),
       start = "topright") +
  geom_treemap() +
  geom_treemap_text(aes(colour = decision),
                    reflow = T,
                    place = "centre",
                    size = 40) +
  geom_treemap_subgroup_text(size = 80, reflow = T) +
  geom_treemap_subgroup_border(size = 10) +
  scale_fill_manual("Test Result", values = c("Negative" = "#ff8b94",
                                              "Positive" = "#a8e6cf")) +
  scale_colour_manual(values = c("Correct" = "#00b159", "Incorrect" = "#d11141")) +
  theme(legend.key.size = unit(0.75, "inches"),
        legend.text = element_text(size = 16),
        legend.title = element_text(size = 20))
```

```{r}
# Waffle chart 
iron(
  waffle(
    c('Test positive' = 19, 'Test negative' = 1),
    colors = c("black", "grey70"),
    size = 0.5,
    pad = 20,
    legend_pos = "none",
    title = "Ill"
  ),
  waffle(
    c('Test positive' = 19, 'Test negative' = 361),
    colors = c("black", "grey70"),
    size = 0.5,
    legend_pos = "bottom",
    title = "Healthy"
  )
)
```

```{r}
ggplot(pictogram_df, aes(label = disease_status, values = frequency, colour = test_result)) +
  geom_pictogram(n_rows = 10, flip = T) +
  scale_colour_manual(name = "Test Result",
                      values = c("Positive" = "Red", "Negative" = "Grey75")) +
  scale_label_pictogram(name = NULL,
                        values = c("Disease" = "user-md", "Healthy" = "smile")) +
  coord_equal() +
  theme(panel.background = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.background = element_blank(),
        legend.position = "none")
```

So, given you receive a positive result the probability you actually have the disease is:

$$\begin{aligned}
\text{Pr}(D|+) &= \frac{\text{True pos.}}{\text{Total pos.}} \\
&= \frac{19}{19 + 19} \\
&= 0.5
\end{aligned}$$

# Research problems

# Statistical cognition

## The linda problem

Extra example of how we aren't intuitive statisticians. 

## All averages aren't made equal

Relative percentage change vs. absolute percentage change (i.e. percentage points) vs. natural frequencies. 