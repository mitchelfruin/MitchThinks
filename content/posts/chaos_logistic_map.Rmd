---
title: "Chaos with a pocket calculator."
author: "Mitchel Fruin"
date: "2019-09-25"
description: "Introduction to chaos theory using the simple population growth example from Robert May's classic paper."
tags: ["Complexity", "Interactive Visualisation"]
slug: chaos_logistic_map
draft: true
output:
  blogdown::html_page:
    toc: true
    toc_depth: 2
    number_sections: true
---

<style type="text/css">
div#TOC li {
    list-style:none;
    background-image:none;
    background-repeat:none;
    background-position:0; 
}
</style>

```{r setup, include=FALSE}
# RMarkdown
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      fig.align = "center",
                      fig.width = 8,
                      fig.height = 5.33)

# Packages
library(tidyverse)
library(plotly)
```

Most non-fiction books teach you *what* to think. They provide you with a new set of facts to trot out when someone brings up pop psychology at the pub or let you feel smart when you parrot some Econ101 theory to 'explain' why the Bank of England cut interest rates. Every now and then, however, a book instead teaches you *how* to think. That is, it helps you see things beyond the scope of its few hundred pages in a markedly different light than you did before. That's what James Gleick's *Chaos* did when I read it earlier this year. It's fantastic, I wish I'd read it much, much sooner, and anyone even remotely interested in science should make it the next book they pick up.

The chapter which stuck in my mind most was one on population biology recounting the work of someone I'd heard a guest lecture from once, Sir Robert May. His lecture was about appling insights gained from studying the ecology of complex systems to re-design the banking system following the 2008 crisis. It, like much of *Chaos* when I first read it, went a fair distance over my head. But, I think a combination of recognising his name, having some familiarity with modelling populations over time, and the memory of the deference with which faculty members spoke about May, meant that when I finished the book I immediately read his seminal paper. At the close of chapter 3 Gleick summarises both the essence of May's argument and the path that his book has sent me down:

> The world would be a better place... if every young student were given a pocket calculator and encouraged to play with the logistic difference difference equation. That simple calculation... could counter the distorted sense of the world's possibilities that comes from a standard scientific education.

Well, R is just a fancy pocket calculator. So, let's start playing, and see if you unlearn as much as I did.

# Introducing A Simple System

The Logistic Difference Equation: simplest discrete non-linear system. 

Make clear the distinction between linear and non-linear dynamics. It's not just about having a curved line, e.g. exponential growth is linear dynamics. 

# Summarising A Simple System

Goal: Make bifurcation diagram from May's paper.

# Understanding A Simple System

Building Nonlinear Intuitions

Goal: Make interactive graph so that the reader can actually understand the bifurcation diagram. 

Make it shiny so they can choose the starting population proportion they want.

```{r define functions}
# Single input function
single_map <- function(start_x, r, n) {
  
  # Empty dataframe
  pop_df <- tibble(generation = 1:n,
                   x = numeric(n))
  
  # Add first generation proportion
  pop_df$x[1] <- start_x
  
  # Simulate n generations
  for (i in 2:n) {
    pop_df$x[i] <- r*pop_df$x[i-1]*(1 - pop_df$x[i-1])
  }
  
  # Final dataframe
  pop_df
}

# Multiple input function
multiple_map <- function(x_opts, r_opts, n_opts) {
  
  # Inputs should all be vectors
  
  # Find all possible input permutations
  inputs_df <- expand.grid("start_x" = x_opts,
                           "r" = r_opts,
                           "n" = n_opts)
  
  # Blank outcome df 
  outcome_df <- tibble(start_x = numeric(),
                       r = numeric(),
                       n = numeric(),
                       generation = numeric(), 
                       x = numeric())
  
  # Use single input function for all permutations
  for (i in 1:nrow(inputs_df)) {
    
    pop_df <- single_map(start_x = inputs_df$start_x[i],
                           r = inputs_df$r[i],
                           n = inputs_df$n[i])
    
    current_inputs <- tibble(start_x = rep(inputs_df$start_x[i],
                                           inputs_df$n[i]),
                             r = rep(inputs_df$r[i],
                                     inputs_df$n[i]),
                             n = rep(inputs_df$n[i],
                                     inputs_df$n[i]))
    
    to_add <- bind_cols(current_inputs, pop_df)
    
    outcome_df <- bind_rows(outcome_df, to_add)
  }
  
  # Convert inputs into factors
  outcome_df <- outcome_df %>%
    mutate(start_x = as.factor(start_x),
           r = as.factor(r),
           n = as.factor(n))
  
  outcome_df
}
```

```{r}
# Choose input options
x_rand <- round(runif(3), 2)
r_opts <- c(seq(2, 4, 0.05))
n_opts <- 100

# Use function
plot_df <- multiple_map(x_rand, r_opts, n_opts)
```

```{r, fig.width=9, fig.height=6}
# Vary r
plot_df %>%
  plot_ly(x = ~generation,
          y = ~x,
          color = ~start_x,
          hoverinfo = "text+name",
          text = ~paste("Generation:", generation, "<br>",
                        "Population:", round(x, 4)),
          frame = ~r) %>%
  add_lines() %>%
  animation_opts(frame = 800,
                 transition = 100,
                 easing = "linear") %>%
  animation_slider(currentvalue = list(prefix = "r = ",
                                       color = toRGB("black"),
                                       size = 25),
                   hide = FALSE) %>%
  layout(xaxis = list(title = "Generation"),
         yaxis = list(title = "Pop. Prop."))
```

Question: Why do mirrors around 0.5 behave the same?

# The Study of Non-Elephant Animals

In the conclusion of his paper, May argues that Chaos should be taught, and taught early. As he saw it, learning to extend linear mathemetics with Fourier transforms, orthogonal functions, and regression techniques, misleads scientists about the world they're trying to understand. "The mathmetical intuition so developed ill equips the student to confront the bizarre behaviour exhibited by the simplest discrete nonlinear systems.", he wrote. "Yet such nonlinear systems are surely the rule, not the exception, outside the physical sciences."

The crucial notion that nonlinear systems are the norm rather than the exception is summed up in my favourite quote from *Chaos* which comes from the mathematician Stanislaw Ulam. He quipped that "to call the study of chaos 'nonlinear science' was like calling zoology 'the study of nonelephant animals'". Defining an entire subject in opposition to a niche class. 

The fact that vast swathes of science emphasise linearity has important implications. Something about people thinking in immediate causes from misunderstanding economics book. Poor at incorporating feedback loops or interative thinking. May's final sentence from over 40 years ago still rings true:

> "Not only in research, but also in the everday world of politics and economics, we would all be better off if more people realized that simple nonlinear systems do not necessarily possess simple dynamical properties."

For me, *Chaos*, and May's paper subsequently, were like finding a peeling bit of wallpaper I just couldn't help but tug at. Once you do, it leaves another little upward curved edge that you, again, can't resist. Pretty soon your neatly plastered scientific worldview is looking pretty fucking messy. It turns out that you can't just break things down into their component parts, understand how they interact, and then add them back together to understand the system as a whole.
