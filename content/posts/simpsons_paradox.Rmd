---
title: "Hidden Trade-Offs and Simpson's Paradox."
author: "Mitchel Fruin"
date: "2020-08-09"
description: "Exploring the presence of a common statistical paradox in evolutionary biology and economics."
tags: ["Probability and Statistics", "Evolution", "Economics"]
slug: simpsons_paradox
output:
  blogdown::html_page:
    toc: true
    toc_depth: 2
    number_sections: true
editor_options: 
  chunk_output_type: console
---

<style type="text/css">
div#TOC li {
    list-style:none;
    background-image:none;
    background-repeat:none;
    background-position:0; 
}
</style>

```{r setup, include=FALSE}
# RMarkdown
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      fig.align = "center",
                      fig.width = 8.09,
                      fig.height = 5)

# Packages
library(tidyverse)
library(plotly)
```

Alternative titles:

* The ladder of causation, evolutionary trade-offs, and Simpson's paradox.
    + Can't resolve the issue from data alone.
    + Include more about the experiments that support the existence of a trade-off.

# Simpson's paradox 

Recently read *The Book of Why* by Judea Pearl & Dana MacKenzie. 
Scrolling through their blog (link) I saw a post re-iterating a point they had made in their chapter Paradoxes Galore in the context of coronvirus deaths by race.
Race and coronavirus example with UK data.

As almost anyone whose done some introductory statistics is, I was familiar, with Simpson's paradox and the original UC Berkely example. 

However, until I read *The Book of Why* it hadn't really dawned on me before how significant a problem it was. Pearl & MacKenzie make the point that there is no data-driven/theory-blind way to determine whether or not you should aggregate the data. You can only make that choice by asking the right causal question.

It then dawned on me that I had seen the same problem ages ago in one of my favourite Biology papers but discussed without any reference to Simpson's paradox.

# Hidden evolutionary trade-offs

In 1986, Arie van Noordwijk and Gerdien de Jong Acquisition and Allocation of Resources: Their Influence on Variation in Life History Tactics.

Diagram for overall model:

```{r}
# simulate data for different acquisition levels
acquire_25 <- tibble(survival = 0:25,
                     reproduction = sort(0:25, decreasing = T))

acquire_50 <- tibble(survival = 0:50,
                     reproduction = sort(0:50, decreasing = T))

acquire_75 <- tibble(survival = 0:75,
                     reproduction = sort(0:75, decreasing = T))

acquire_100 <- tibble(survival = 0:100,
                      reproduction = sort(0:100, decreasing = T))

acquisition_levels <- bind_rows("25" = acquire_25,
                                "50" = acquire_50,
                                "75" = acquire_75,
                                "100" = acquire_100,
                                .id = "acquisition_level") %>%
  mutate(acquisition_level = as.factor(as.numeric(acquisition_level)))

# Simulate data for different allocation trade-offs
allocate_equal <- tibble(survival = 1:50, reproduction = 1:50)

allocate_r <- allocate_equal %>%
  mutate(survival = survival/2, reproduction = reproduction*3/2)

allocate_s <- allocate_equal %>%
  mutate(survival = survival*3/2, reproduction = reproduction/2)

allocation_levels <- bind_rows("3:1" = allocate_r, 
                               "1:1" = allocate_equal,
                               "1:3" = allocate_s,
                               .id = "r_s_ratio")

allocation_levels %>%
  ggplot(aes(x = survival, y = reproduction)) +
  geom_line(aes(col = acquisition_level), data = acquisition_levels) +
  geom_line(aes(lty = r_s_ratio)) +
  scale_x_continuous("Energy allocated to survival") +
  scale_y_continuous("Energy\nallocated\nto\nreproduction") +
  scale_color_viridis_d("Energy Level") +
  scale_linetype_manual("Reproduction:Survival\nAllocation Ratio",
                        values = c(1, 2, 3)) +
  coord_fixed() +
  theme_minimal() +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5))
```

Diagram for when variation in acquisition >> than variation in allocation:

```{r}
# simulate data for large difference in acquisition levels
acquisition_levels <- bind_rows("25" = acquire_25,
                                "100" = acquire_100,
                                .id = "acquisition_level") %>%
  mutate(acquisition_level = as.factor(as.numeric(acquisition_level)))

# Simulate data for small difference in allocation trade-offs
allocate_r <- allocate_equal %>%
  mutate(survival = survival*9/10, reproduction = reproduction*11/10)

allocate_s <- allocate_equal %>%
  mutate(survival = survival*11/10, reproduction = reproduction*9/10)

allocation_levels <- bind_rows("11:9" = allocate_r,
                               "9:11" = allocate_s,
                               .id = "r_s_ratio")

# Write points of intersection
intersects <- tibble(x = c(13.75, 11.25, 45, 55),
                     y = c(11.75, 13.75, 55, 45))

# Visualise
allocation_levels %>%
  ggplot(aes(x = survival, y = reproduction)) +
  geom_line(aes(col = acquisition_level), data = acquisition_levels) +
  geom_line(aes(lty = r_s_ratio)) +
  geom_polygon(aes(x = x, y = y), data = intersects, fill = "grey") +
  scale_x_continuous("Energy allocated to survival") +
  scale_y_continuous("Energy\nallocated\nto\nreproduction") +
  scale_color_viridis_d("Energy Level") +
  scale_linetype_manual("Reproduction:Survival\nAllocation Ratio",
                        values = c(3, 2)) +
  coord_fixed() +
  theme_minimal() +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5))
```

Diagram for when variation in acquisition << than variation in allocation:

```{r}
# simulate data for small difference in acquisition levels
acquire_45 <- tibble(survival = 0:45,
                     reproduction = sort(0:45, decreasing = T))

acquire_55 <- tibble(survival = 0:55,
                     reproduction = sort(0:55, decreasing = T))

acquisition_levels <- bind_rows("45" = acquire_45,
                                "55" = acquire_55,
                                .id = "acquisition_level") %>%
  mutate(acquisition_level = as.factor(as.numeric(acquisition_level)))

# Simulate data for large difference in allocation trade-offs
allocate_r <- allocate_equal %>%
  mutate(survival = survival/2, reproduction = reproduction*3/2)

allocate_s <- allocate_equal %>%
  mutate(survival = survival*3/2, reproduction = reproduction/2)

allocation_levels <- bind_rows("3:1" = allocate_r, 
                               "1:3" = allocate_s,
                               .id = "r_s_ratio")

# Write points of intersection
intersects <- tibble(x = c(33.75, 11.25, 13.75, 41.25),
                     y = c(11.25, 33.75, 41.25, 13.75))

# Visualise
allocation_levels %>%
  ggplot(aes(x = survival, y = reproduction)) +
  geom_line(aes(col = acquisition_level), data = acquisition_levels) +
  geom_line(aes(lty = r_s_ratio)) +
  geom_polygon(aes(x = x, y = y), data = intersects, fill = "grey") +
  scale_x_continuous("Energy allocated to survival") +
  scale_y_continuous("Energy\nallocated\nto\nreproduction") +
  scale_color_viridis_d("Energy Level") +
  scale_linetype_manual("Reproduction:Survival\nAllocation Ratio",
                        values = c(2, 3)) +
  coord_fixed() +
  theme_minimal() +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5))
```

# Hidden economic trade-offs

They draw quick analogy at the end of their paper which really crystallises the point. 

Within a given budget level we expect house price and car price to be negatively correlated. 

* People who earn 30k a year and spent a large fraction of that on a house will have less money left to spend on a car. 
* People who earn 60k a year and spent a large fraction of that on a house will similarly have less money left over to spend on a car.

But on the whole, i.e. across many budget levels, we expect house price and car price to be positively correlated. 

* People who earn 60k a year will have both a more expensive house and more expensive car than people who earn 30k a year.

Imagine three facts about me (if you know me, then you'll have to try pretty hard):

1. I earn 50k a year.
2. I own a house.
3. I own a car.

Now consider the following two scenarios:

**Scenario 1.** If I told you that my imaginary house was more expensive than the average house in the UK, what would you predict about the value of my car compared to the UK average?

A. My car is worth the same as the UK average. 
B. My car is worth less than the UK average.
C. My car is worth more than the UK average. 

I expect that you picked option C meaning you thought that if I had an expensive house then it stands to reason that I'd have an expensive car too. I.e. You predicted that there's a **positive correlation** between house value and car value in the general population.

**Scenario 2.** If I told you that my house was more expensive than the average house for people who earn 50k, what would you predict about the value of my car compared to the average for people who earn 50k?

A. My car is worth the same as the 50k-earner average. 
B. My car is worth less than the 50k-earner average.
C. My car is worth more than the 50k-earner average. 

I expect that you picked option B meaning you thought that if I had an expensive house, then I must have less money left in my 50k budget to spend on a car, an therefore will have a cheaper than average car. I.e. You predicted that there's a **negative correlation** between house value and car value in the sub-population of people earning 50k a year.

Predicted the opposite relationship between the same two variables in the different scenarios.

These two choices illustrate an interesting pattern that crops up reasonably often. When we split data into groups or group data into populations we can reverse the relationship between two variables.